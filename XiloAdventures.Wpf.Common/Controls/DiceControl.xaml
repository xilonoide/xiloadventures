<UserControl x:Class="XiloAdventures.Wpf.Common.Controls.DiceControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="120" d:DesignWidth="120"
             MouseLeftButtonDown="UserControl_MouseLeftButtonDown"
             Cursor="Hand">
    <UserControl.Resources>
        <!-- Colores del dado -->
        <SolidColorBrush x:Key="NormalDiceColor" Color="#90EE90"/>
        <SolidColorBrush x:Key="CriticalDiceColor" Color="#FFD700"/>
        <SolidColorBrush x:Key="FumbleDiceColor" Color="#FF4444"/>
        <SolidColorBrush x:Key="InactiveDiceColor" Color="#555555"/>

        <!-- Animación de sacudida -->
        <Storyboard x:Key="ShakeAnimation" RepeatBehavior="Forever">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DiceTransform"
                                           Storyboard.TargetProperty="Angle">
                <EasingDoubleKeyFrame KeyTime="0:0:0.00" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.05" Value="-15"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.10" Value="15"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.15" Value="-10"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.20" Value="10"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.25" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <!-- Animación de impacto al mostrar resultado -->
        <Storyboard x:Key="ImpactAnimation">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DiceScale"
                                           Storyboard.TargetProperty="ScaleX">
                <EasingDoubleKeyFrame KeyTime="0:0:0.00" Value="1.0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.10" Value="1.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.30" Value="1.0"/>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DiceScale"
                                           Storyboard.TargetProperty="ScaleY">
                <EasingDoubleKeyFrame KeyTime="0:0:0.00" Value="1.0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.10" Value="1.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.30" Value="1.0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <!-- Animación de resplandor azul con efecto de respiración -->
        <Storyboard x:Key="GlowAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="DiceGlow"
                             Storyboard.TargetProperty="Opacity"
                             From="0.4" To="1.0"
                             Duration="0:0:0.8"
                             AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="DiceGlow"
                             Storyboard.TargetProperty="BlurRadius"
                             From="20" To="40"
                             Duration="0:0:0.8"
                             AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="DiceGlowShape"
                             Storyboard.TargetProperty="StrokeThickness"
                             From="3" To="8"
                             Duration="0:0:0.8"
                             AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </UserControl.Resources>

    <Grid>
        <Viewbox Stretch="Uniform" Margin="5">
            <Grid Width="100" Height="100" RenderTransformOrigin="0.5,0.5">
                <Grid.RenderTransform>
                    <TransformGroup>
                        <RotateTransform x:Name="DiceTransform" Angle="0"/>
                        <ScaleTransform x:Name="DiceScale" ScaleX="1" ScaleY="1"/>
                    </TransformGroup>
                </Grid.RenderTransform>

                <!-- Efecto de resplandor azul (visible cuando está habilitado para tirar) -->
                <Polygon x:Name="DiceGlowShape"
                         Points="50,5 95,30 95,70 50,95 5,70 5,30"
                         Fill="Transparent"
                         Stroke="#4A90D9"
                         StrokeThickness="3"
                         Visibility="Collapsed">
                    <Polygon.Effect>
                        <DropShadowEffect x:Name="DiceGlow"
                                          Color="#4A90D9"
                                          BlurRadius="20"
                                          ShadowDepth="0"
                                          Opacity="0.8"/>
                    </Polygon.Effect>
                </Polygon>

                <!-- Forma del D20 (icosaedro simplificado como hexágono) -->
                <Polygon x:Name="DiceShape"
                         Points="50,5 95,30 95,70 50,95 5,70 5,30"
                         Fill="{StaticResource InactiveDiceColor}"
                         Stroke="#333333"
                         StrokeThickness="2">
                    <Polygon.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="3" Opacity="0.5"/>
                    </Polygon.Effect>
                </Polygon>

                <!-- Líneas internas del D20 -->
                <Path x:Name="DiceLines"
                      Stroke="#22222240"
                      StrokeThickness="1"
                      Data="M50,5 L50,95 M5,30 L95,70 M95,30 L5,70"/>

                <!-- Texto del valor -->
                <TextBlock x:Name="DiceValueText"
                           Text="D20"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="#1E1E1E"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Grid>
        </Viewbox>

    </Grid>
</UserControl>
