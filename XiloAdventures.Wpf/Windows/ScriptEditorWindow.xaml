<Window x:Class="XiloAdventures.Wpf.Windows.ScriptEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:XiloAdventures.Wpf.Controls"
        xmlns:local="clr-namespace:XiloAdventures.Wpf.Windows"
        Title="Editor de Scripts"
        Icon="/appicon.ico"
        Height="700" Width="1100"
        MinHeight="500" MinWidth="800"
        Background="#222222"
        Foreground="White"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Undo"
                        CanExecute="Undo_CanExecute"
                        Executed="Undo_Executed"/>
        <CommandBinding Command="ApplicationCommands.Redo"
                        CanExecute="Redo_CanExecute"
                        Executed="Redo_Executed"/>
        <CommandBinding Command="ApplicationCommands.Cut"
                        CanExecute="CutCopyCommand_CanExecute"
                        Executed="CutCommand_Executed"/>
        <CommandBinding Command="ApplicationCommands.Copy"
                        CanExecute="CutCopyCommand_CanExecute"
                        Executed="CopyCommand_Executed"/>
        <CommandBinding Command="ApplicationCommands.Paste"
                        CanExecute="PasteCommand_CanExecute"
                        Executed="PasteCommand_Executed"/>
    </Window.CommandBindings>

    <Window.InputBindings>
        <KeyBinding Command="ApplicationCommands.Undo"
                Modifiers="Control"
                Key="Z"/>
        <KeyBinding Command="ApplicationCommands.Redo"
                Modifiers="Control+Shift"
                Key="Z"/>
        <KeyBinding Command="ApplicationCommands.Cut"
                Modifiers="Control"
                Key="X"/>
        <KeyBinding Command="ApplicationCommands.Copy"
                Modifiers="Control"
                Key="C"/>
        <KeyBinding Command="ApplicationCommands.Paste"
                Modifiers="Control"
                Key="V"/>
    </Window.InputBindings>

    <Window.Resources>
        <Style x:Key="TopMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#303030"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Grid>
                            <Border x:Name="Border" Background="{TemplateBinding Background}">
                                <ContentPresenter Margin="6,2"
                                                  ContentSource="Header"
                                                  RecognizesAccessKey="True"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                            </Border>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsSubmenuOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   StaysOpen="False">
                                <Border Background="#303030" BorderBrush="#303030" BorderThickness="1">
                                    <StackPanel IsItemsHost="True"/>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#505050"/>
                            </Trigger>
                            <Trigger Property="IsSubmenuOpen" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#505050"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#888888"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SubMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#303030"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="Border" Background="{TemplateBinding Background}">
                            <Grid Margin="4,1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ContentPresenter Grid.Column="0"
                                                  ContentSource="Icon"
                                                  Margin="0,0,6,0"
                                                  VerticalAlignment="Center"/>
                                <ContentPresenter Grid.Column="1"
                                                  ContentSource="Header"
                                                  VerticalAlignment="Center"
                                                  RecognizesAccessKey="True"/>
                                <TextBlock Grid.Column="2"
                                           Text="{TemplateBinding InputGestureText}"
                                           Foreground="#888888"
                                           Margin="20,0,0,0"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#505050"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#888888"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Dark ComboBox Style -->
        <Style x:Key="DarkComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#444444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#555555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                          Background="{TemplateBinding Background}"
                                          BorderBrush="{TemplateBinding BorderBrush}"
                                          BorderThickness="{TemplateBinding BorderThickness}"
                                          Focusable="False"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border x:Name="Border"
                                                Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="3">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>
                                                <Path x:Name="Arrow"
                                                      Grid.Column="1"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"
                                                      Data="M 0 0 L 4 4 L 8 0 Z"
                                                      Fill="#AAAAAA"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="#555555"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <ContentPresenter x:Name="ContentSite"
                                              IsHitTestVisible="False"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="6,4,24,4"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"/>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                                      SnapsToDevicePixels="True"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                                            Background="#3A3A3A"
                                            BorderBrush="#555555"
                                            BorderThickness="1"
                                            CornerRadius="3">
                                        <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                        </ScrollViewer>
                                    </Border>
                                </Grid>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Dark ComboBoxItem Style -->
        <Style x:Key="DarkComboBoxItemStyle" TargetType="ComboBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#505050"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#606060"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#888888"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top"
              Background="#303030"
              Foreground="White"
              Margin="0,4,0,0">
            <MenuItem Header="Editar" Style="{StaticResource TopMenuItemStyle}">
                <MenuItem Header="Deshacer"
                          Command="ApplicationCommands.Undo"
                          InputGestureText="Ctrl+Z"
                          Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   VerticalAlignment="Center"
                                   Text="&#xE10E;"
                                   FontSize="18"
                                   Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Rehacer"
                          Command="ApplicationCommands.Redo"
                          InputGestureText="Ctrl+Shift+Z"
                          Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   VerticalAlignment="Center"
                                   Text="&#xE10D;"
                                   FontSize="18"
                                   Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Cortar"
                          Command="ApplicationCommands.Cut"
                          InputGestureText="Ctrl+X"
                          Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   VerticalAlignment="Center"
                                   Text="&#xE16B;"
                                   FontSize="18"
                                   Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Copiar"
                          Command="ApplicationCommands.Copy"
                          InputGestureText="Ctrl+C"
                          Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   VerticalAlignment="Center"
                                   Text="&#xE16A;"
                                   FontSize="18"
                                   Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Pegar"
                          Command="ApplicationCommands.Paste"
                          InputGestureText="Ctrl+V"
                          Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   VerticalAlignment="Center"
                                   Text="&#xE16D;"
                                   FontSize="18"
                                   Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <Border DockPanel.Dock="Top" Background="#2B2B2B" Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left side: view controls and script buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left">
                    <Button Style="{StaticResource CommandButtonStyle}"
                            ToolTip="Nuevo script para esta entidad"
                            Click="NewScript_Click"
                            Margin="0,0,4,0">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE710;"
                                   Foreground="#90EE90"
                                   FontSize="16"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </Button>

                    <Button x:Name="DeleteScriptButton"
                            Style="{StaticResource CommandButtonStyle}"
                            ToolTip="Eliminar script actual"
                            Click="DeleteScript_Click"
                            Margin="0,0,4,0">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE74D;"
                                   Foreground="#FF6B6B"
                                   FontSize="16"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </Button>

                    <Button x:Name="PlayScriptButton"
                            Style="{StaticResource CommandButtonStyle}"
                            ToolTip="Ejecutar script (solo en modo prueba)"
                            Click="PlayScript_Click"
                            Visibility="Collapsed"
                            Margin="0,0,20,0">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE768;"
                                   Foreground="#00FF00"
                                   FontSize="16"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </Button>

                    <ToggleButton x:Name="ToggleGridButton"
                                  Style="{StaticResource ToggleCommandButtonStyle}"
                                  Click="ToggleGridButton_Click"
                                  ToolTip="Mostrar/Ocultar grid (G)"
                                  Margin="0,4,6,0">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE80A;"
                                   Foreground="#FFD700"
                                   FontSize="18"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </ToggleButton>

                    <ToggleButton x:Name="ToggleSnapButton"
                                  Style="{StaticResource ToggleCommandButtonStyle}"
                                  Click="ToggleSnapButton_Click"
                                  ToolTip="Snap to grid (H)"
                                  Margin="0,4,6,0">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE7C1;"
                                   Foreground="#FFD700"
                                   FontSize="18"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </ToggleButton>

                    <Button Style="{StaticResource CommandButtonStyle}"
                            ToolTip="Centrar vista (F)"
                            Click="CenterView_Click">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE799;"
                                   Foreground="White"
                                   FontSize="18"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </Button>
                </StackPanel>

                <!-- Center: Script name -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="Script:" Foreground="#AAAAAA" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox x:Name="ScriptNameTextBox"
                             Width="200"
                             Height="26"
                             Background="#444444"
                             Foreground="White"
                             BorderThickness="0"
                             Padding="6,2"
                             VerticalContentAlignment="Center"/>
                </StackPanel>

                <!-- Right side: Otros scripts -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right">
                    <TextBlock Text="Otros scripts:" Foreground="#AAAAAA" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox x:Name="ScriptSelectorCombo"
                              Width="200"
                              Height="26"
                              Style="{StaticResource DarkComboBoxStyle}"
                              ItemContainerStyle="{StaticResource DarkComboBoxItemStyle}"
                              SelectionChanged="ScriptSelectorCombo_SelectionChanged"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition x:Name="TestPanelColumn" Width="0"/>
            </Grid.ColumnDefinitions>

            <!-- Center: Script Canvas (behind other panels) -->
            <controls:ScriptPanel x:Name="ScriptPanel"
                                  Grid.Column="0"
                                  Grid.ColumnSpan="5"
                                  Panel.ZIndex="0"
                                  ClipToBounds="True"/>

            <!-- Left Panel: Entity Tree -->
            <Border Grid.Column="0"
                    Panel.ZIndex="1"
                    MinWidth="200"
                    Background="#333333">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="#444444" Padding="8,6">
                        <TextBlock Text="ENTIDADES"
                                   FontWeight="SemiBold"
                                   FontSize="13"
                                   Foreground="#AAAAAA"/>
                    </Border>

                    <!-- Buscador y botones expandir/contraer -->
                    <DockPanel Grid.Row="1" Margin="4">
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                            <Button Width="24"
                                    Height="24"
                                    Margin="0,0,2,0"
                                    Click="ExpandAllEntities_Click"
                                    ToolTip="Expandir todo"
                                    Background="#444444"
                                    BorderBrush="#555555">
                                <TextBlock FontFamily="Segoe MDL2 Assets"
                                           VerticalAlignment="Center"
                                           Text="&#xE70D;"
                                           FontSize="14"
                                           Foreground="White"
                                           HorizontalAlignment="Center"/>
                            </Button>
                            <Button Width="24"
                                    Height="24"
                                    Margin="0,0,4,0"
                                    Click="CollapseAllEntities_Click"
                                    ToolTip="Contraer todo"
                                    Background="#444444"
                                    BorderBrush="#555555">
                                <TextBlock FontFamily="Segoe MDL2 Assets"
                                           VerticalAlignment="Center"
                                           Text="&#xE70E;"
                                           FontSize="14"
                                           Foreground="White"
                                           HorizontalAlignment="Center"/>
                            </Button>
                        </StackPanel>
                        <TextBox x:Name="EntitySearchTextBox"
                                 FontSize="12"
                                 Background="#3A3A3A"
                                 Foreground="White"
                                 BorderBrush="#555555"
                                 TextChanged="EntitySearchTextBox_TextChanged"/>
                    </DockPanel>

                    <TreeView x:Name="EntityTree"
                              Grid.Row="2"
                              SelectedItemChanged="EntityTree_SelectedItemChanged"
                              PreviewMouseRightButtonDown="EntityTree_PreviewMouseRightButtonDown"
                              Background="#333333"
                              BorderThickness="0">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="Background" Value="#333333"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#505050"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TreeView.ItemContainerStyle>
                    </TreeView>
                </Grid>
            </Border>

            <!-- Second Left Panel: Node Palette -->
            <Border Grid.Column="1"
                    Panel.ZIndex="1"
                    Width="200"
                    Background="#333333">
                <controls:NodePalette x:Name="NodePalette"/>
            </Border>

            <!-- Right Panel: Properties + Diagnostics -->
            <Border Grid.Column="3"
                    Panel.ZIndex="1"
                    Width="250"
                    Background="#333333">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="#444444" Padding="8,6">
                        <TextBlock Text="PROPIEDADES"
                                   FontWeight="SemiBold"
                                   FontSize="13"
                                   Foreground="#AAAAAA"/>
                    </Border>

                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <StackPanel x:Name="PropertiesPanel" Margin="8"/>
                    </ScrollViewer>

                    <!-- Diagnostic Panel -->
                    <Border Grid.Row="2" Background="#2a2a2a" BorderThickness="0,1,0,0" BorderBrush="#444444">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="#3a3a3a" Padding="8,6">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock x:Name="DiagnosticIcon"
                                               Text="●"
                                               FontSize="12"
                                               VerticalAlignment="Center"
                                               Margin="0,0,6,0"/>
                                    <TextBlock Text="ESTADO"
                                               FontWeight="SemiBold"
                                               FontSize="13"
                                               Foreground="#AAAAAA"/>
                                </StackPanel>
                            </Border>

                            <StackPanel x:Name="DiagnosticPanel"
                                        Grid.Row="1"
                                        Margin="8"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Test Panel (visible solo en modo prueba) -->
            <Border x:Name="TestPanel"
                    Grid.Column="4"
                    Panel.ZIndex="1"
                    Background="#1A1A1A"
                    BorderBrush="#0078D4"
                    BorderThickness="2"
                    CornerRadius="4"
                    Visibility="Collapsed">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="180"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Cabecera -->
                    <DockPanel Grid.Row="0" Grid.ColumnSpan="2" Margin="0,0,0,8">
                        <TextBlock x:Name="TestRoomTitle"
                                   Text="Prueba"
                                   FontWeight="Bold"
                                   FontSize="14"
                                   Foreground="#0078D4"
                                   VerticalAlignment="Center"/>
                    </DockPanel>

                    <!-- Imagen de sala -->
                    <Border Grid.Row="1" Grid.ColumnSpan="2"
                            Background="#101010"
                            Margin="0,0,0,8"
                            MaxHeight="150">
                        <Image x:Name="TestRoomImage"
                               Stretch="Uniform"/>
                    </Border>

                    <!-- Columna izquierda: descripción + consola -->
                    <Grid Grid.Row="2" Grid.Column="0" Margin="0,0,8,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Descripción de sala -->
                        <TextBlock x:Name="TestRoomDescription"
                                   Grid.Row="0"
                                   TextWrapping="Wrap"
                                   FontFamily="Consolas"
                                   FontSize="14"
                                   Foreground="#CCCCCC"
                                   Margin="0,0,0,8"/>

                        <!-- Salida de texto -->
                        <RichTextBox x:Name="TestOutputTextBox"
                                     Grid.Row="1"
                                     Background="#181818"
                                     Foreground="White"
                                     BorderThickness="1"
                                     BorderBrush="#333333"
                                     IsReadOnly="True"
                                     VerticalScrollBarVisibility="Auto"
                                     FontFamily="Consolas"
                                     FontSize="14"/>
                    </Grid>

                    <!-- Columna derecha: estado e inventario -->
                    <ScrollViewer Grid.Row="2" Grid.Column="1"
                                  VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <TextBlock x:Name="TestStatsLabel"
                                       TextWrapping="Wrap"
                                       FontSize="14"
                                       Foreground="#AAAAAA"
                                       Margin="0,0,0,8"/>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Dinero: " FontWeight="Bold" FontSize="14" Foreground="White"/>
                                <TextBlock x:Name="TestMoneyLabel" FontSize="14" Foreground="#AAAAAA"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Hora: " FontWeight="Bold" FontSize="14" Foreground="White"/>
                                <TextBlock x:Name="TestTimeLabel" FontSize="14" Foreground="#AAAAAA"/>
                            </StackPanel>

                            <TextBlock Text="Equipo"
                                       FontWeight="Bold"
                                       FontSize="14"
                                       Foreground="White"
                                       Margin="0,0,0,4"/>
                            <TextBlock x:Name="TestEquipmentLabel"
                                       TextWrapping="Wrap"
                                       FontSize="14"
                                       Foreground="#AAAAAA"/>

                            <TextBlock Text="Inventario"
                                       FontWeight="Bold"
                                       FontSize="14"
                                       Foreground="White"
                                       Margin="0,8,0,4"/>
                            <TextBlock x:Name="TestInventoryLabel"
                                       TextWrapping="Wrap"
                                       FontSize="14"
                                       Foreground="#AAAAAA"/>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Entrada de comandos -->
                    <DockPanel Grid.Row="3" Grid.ColumnSpan="2" Margin="0,8,0,0">
                        <TextBlock Text="&gt;"
                                   Foreground="#0078D4"
                                   FontWeight="Bold"
                                   FontSize="14"
                                   Margin="0,0,6,0"
                                   VerticalAlignment="Center"/>
                        <TextBox x:Name="TestInputTextBox"
                                 Background="#252525"
                                 Foreground="White"
                                 BorderBrush="#444444"
                                 FontFamily="Consolas"
                                 FontSize="14"
                                 PreviewKeyDown="TestInputTextBox_KeyDown"
                                 VerticalContentAlignment="Center"/>
                    </DockPanel>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>
