<Window x:Class="XiloAdventures.Wpf.Windows.WorldEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:XiloAdventures.Wpf.Controls"
        Title="Editor de mundos"
        Height="700" Width="1200"
        WindowStartupLocation="CenterOwner"
        WindowState="Maximized"
        Background="#222222"
        Foreground="White">

    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Undo"
                        CanExecute="Undo_CanExecute"
                        Executed="Undo_Executed" />
        <CommandBinding Command="ApplicationCommands.Redo"
                        CanExecute="Redo_CanExecute"
                        Executed="Redo_Executed" />
        <CommandBinding Command="ApplicationCommands.Cut"
                        CanExecute="CutCopyCommand_CanExecute"
                        Executed="CutCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Copy"
                        CanExecute="CutCopyCommand_CanExecute"
                        Executed="CopyCommand_Executed" />
        <CommandBinding Command="ApplicationCommands.Paste"
                        CanExecute="PasteCommand_CanExecute"
                        Executed="PasteCommand_Executed" />
    </Window.CommandBindings>

    <Window.InputBindings>
        <KeyBinding Command="ApplicationCommands.Undo" Modifiers="Control" Key="Z" />
        <KeyBinding Command="ApplicationCommands.Redo" Modifiers="Control+Shift" Key="Z" />
        <KeyBinding Command="ApplicationCommands.Cut" Modifiers="Control" Key="X" />
        <KeyBinding Command="ApplicationCommands.Copy" Modifiers="Control" Key="C" />
        <KeyBinding Command="ApplicationCommands.Paste" Modifiers="Control" Key="V" />
    </Window.InputBindings>

    <DockPanel>
        
        <Menu DockPanel.Dock="Top" Background="#303030" Foreground="White">
            <Menu.Resources>
                <!-- Estilo para elementos de nivel superior (Archivo, Ayuda) -->
                <Style x:Key="TopMenuItemStyle" TargetType="MenuItem">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Background" Value="#303030"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="MenuItem">
                                <Grid>
                                    <Border x:Name="Border"
                                            Background="{TemplateBinding Background}">
                                        <ContentPresenter Margin="6,2"
                                                          ContentSource="Header"
                                                          RecognizesAccessKey="True"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                    <Popup x:Name="Popup"
                                           Placement="Bottom"
                                           IsOpen="{TemplateBinding IsSubmenuOpen}"
                                           AllowsTransparency="True"
                                           Focusable="False"
                                           StaysOpen="False">
                                        <Border Background="#303030"
                                                BorderBrush="#303030"
                                                BorderThickness="1">
                                            <StackPanel IsItemsHost="True" />
                                        </Border>
                                    </Popup>
                                </Grid>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsHighlighted" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="#505050"/>
                                    </Trigger>
                                    <Trigger Property="IsKeyboardFocused" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="#505050"/>
                                    </Trigger>
                                    <Trigger Property="IsSubmenuOpen" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="#505050"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Foreground" Value="#888888"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>

                <!-- Estilo para elementos dentro de los menÃºs desplegados -->
                <Style x:Key="SubMenuItemStyle" TargetType="MenuItem">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Background" Value="#303030"/>
                    <Setter Property="Padding" Value="6,2"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="MenuItem">
                                <Border x:Name="Border"
                                        Background="{TemplateBinding Background}">
                                    <Grid Margin="4,1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter Grid.Column="0"
                                                          ContentSource="Icon"
                                                          Margin="0,0,6,0"
                                                          VerticalAlignment="Center"/>
                                        <ContentPresenter Grid.Column="1"
                                                          ContentSource="Header"
                                                          VerticalAlignment="Center"
                                                          RecognizesAccessKey="True"/>
                                    </Grid>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsHighlighted" Value="True">
                                        <Setter TargetName="Border" Property="Background" Value="#505050"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Foreground" Value="#888888"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Menu.Resources>

            <MenuItem Header="Archivo" Style="{StaticResource TopMenuItemStyle}">
                <MenuItem Header="Nuevo" Click="NewMenu_Click" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ†•" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Abrir..." Click="OpenMenu_Click" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ“‚" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Guardar" Click="SaveMenu_Click" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ’¾" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Guardar como..." Click="SaveAsMenu_Click" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ“" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Cerrar" Click="CloseMenu_Click" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="âœ–" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="Editar" Style="{StaticResource TopMenuItemStyle}">
                <MenuItem Header="Deshacer" Command="ApplicationCommands.Undo" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="â†¶" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Rehacer" Command="ApplicationCommands.Redo" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="â†·" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Cortar" Command="ApplicationCommands.Cut" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="âœ‚" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Copiar" Command="ApplicationCommands.Copy" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ“„" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Pegar" Command="ApplicationCommands.Paste" Style="{StaticResource SubMenuItemStyle}">
                    <MenuItem.Icon>
                        <TextBlock Text="ðŸ“‹" FontSize="14" Margin="2"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>


        <ToolBar DockPanel.Dock="Top" Background="#303030">
            <Button x:Name="PlayButton"
                    Margin="2"
                    Click="PlayButton_Click"
                    ToolTip="Probar mundo (nueva partida)"
                    Foreground="LawnGreen">
                <TextBlock Text="â–¶" FontSize="14" />
            </Button>
            <Separator/>
            <Button Content="Sala" Click="AddRoom_Click" Margin="2" Foreground="White"/>
            <Button Content="Salida" Click="AddExit_Click" Margin="2" Foreground="White"/>
            <Button Content="Llave" Click="AddKey_Click" Margin="2" Foreground="White"/>
            <Button Content="Objeto" Click="AddObject_Click" Margin="2" Foreground="White"/>
            <Button Content="NPC" Click="AddNpc_Click" Margin="2" Foreground="White"/>
            <Button Content="MisiÃ³n" Click="AddQuest_Click" Margin="2" Foreground="White"/>
            <Separator/>
            <Button Content="Expandir todo" Click="ExpandAll_Click" Margin="2" Foreground="White"/>
            <Button Content="Contraer todo" Click="CollapseAll_Click" Margin="2" Foreground="White"/>
        </ToolBar>

        <Grid Margin="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="5*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Panel central: mapa (fondo detrÃ¡s de Ã¡rbol y propiedades) -->
            <controls:MapPanel x:Name="MapPanel"
                               Grid.Column="0" Grid.ColumnSpan="3"
                               Grid.Row="0" Grid.RowSpan="3"
                               Margin="0"
                               Panel.ZIndex="0"
                               ClipToBounds="True"
                               Background="#202020"/>

<!-- Panel izquierdo: bÃºsqueda + Ã¡rbol -->
            <StackPanel Grid.Column="0" Grid.Row="0" Grid.RowSpan="2" Margin="0,0,4,0"
                        Background="#333333"
                        Panel.ZIndex="1">
                <TextBox x:Name="SearchTextBox"
                         Margin="0,0,0,4"
                         TextChanged="SearchTextBox_TextChanged"/>
                <TreeView x:Name="WorldTree"
                          SelectedItemChanged="WorldTree_SelectedItemChanged"
                          KeyDown="WorldTree_KeyDown"
                          MouseDoubleClick="WorldTree_MouseDoubleClick"
                          Background="#333333"
                          BorderBrush="#555555">
                    <TreeView.ItemContainerStyle>
                        <Style TargetType="TreeViewItem">
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="Background" Value="#333333"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#505050"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TreeView.ItemContainerStyle>
                </TreeView>
            </StackPanel>

<!-- Panel derecho: propiedades -->
            <StackPanel Grid.Column="2" Grid.Row="0" Grid.RowSpan="2" Margin="4,0,0,0"
                        Background="#333333"
                        Panel.ZIndex="1">
                <controls:PropertyEditor x:Name="PropertyEditor" />
            </StackPanel>

            <StackPanel Grid.Column="2" Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="4,4,0,0">
                <Button x:Name="RoomImageButton"
                        Content="Imagen..."
                        Width="120"
                        Margin="0,0,8,0"
                        Click="RoomImageButton_Click"
                        Visibility="Collapsed" />
                <Button x:Name="RoomMusicButton"
                        Content="MÃºsica..."
                        Width="120"
                        Click="RoomMusicButton_Click"
                        Visibility="Collapsed" />
            </StackPanel>
        </Grid>
    </DockPanel>
</Window>
